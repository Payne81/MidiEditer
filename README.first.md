# MidiEditer

## 关于项目

最初做这个项目，目的是在工作至于找些喜欢的方向研究和开发点东西出来，也想多了解相关领域的技术现状。
但是一段时间下来已然没有了热情，一方面是工作原因，平时在公司服务设计和维持稳定上消耗了我大部分精力，
闲暇时间有时候更乐意去做在我看来能恢复我生产力的事情；另一方面，项目也从雏形开始有了一个稍微成型的
框架，一起参与开发的朋友时间上也不同步，由此带来的沟通以及开发上的不同步，低效的开发和测试摧毁着我的
开发效率和热情。

关于此算法，以下分成两个部分，需求部分以及实现部分。实现部分又分为MidiFile库的应用和MidiEditer的业务逻辑。

## 需求

此算法最初目标是，接受来自键盘(或电子琴，网页前端)的原始midi数据，根据特定的和弦进行，进行和弦外音的剔除，
音符的量化，去重和延音，音符力度的调整(或者量化)等处理，从而达到能在一段特定的和弦进行中，即兴的旋律能够更
好听(或者更加符合大众的耳朵)

### 和弦外音的去除

初版算法中包含此部分，但是最初的算法用枚举来定义和弦进行也太傻逼了。如果每次新增一个伴奏都要修改代码，那也太不智能了。

后续版本中网页前端和硬件先后处理了和弦外音剔除的功能，此功能暂时弃用。如果需要重新需要开发此功能，需要重新设计
接口，并重构此部分代码。

### 量化

### 去重

### 延音

### 力度量化

## 实现

### MidiFile

参考README.midifile.md。

### Editer

MidiNote: MidiEvent对， 一对MidiEvent表示一个音符的起始和结束

### 存在问题以及改进

代码以及开发流程工具等问题：

1. 修改是在原文件上进行的， 假如代码core dump了，前端无法察觉，查记录又比较难查。解决方式: 修改保存到新文件，调用算法的时候检查不到新文件就报错；或者调用程序自行检测core文件(不建议，万一没设置ulimit -c呢)。
2. 建议先开发一个midi可视化的脚本... 不然开发自测非常吔..., 不要考musescore这种来读midi， musescore会做一定处理再展示谱子，要是真看musescore上的来开发自测必定会吔...
3. 我怀疑...前端生成midi信号的时候有丢失...有的midi信号有音头但没有结束... 需要检验一下 确实不对劲！用MidiReader读一下，里面的音符对和正常生成的midi文件音符对不上
4. 长音被截断成短音原因: 有一个很长的音，跟当前音音高一样但不是一个音，结果选变化音把两者截断了

项目问题:

1. 需求需要严格评审
2. 软件质量需要评审，能否验收已经运行的风险需要仔细评估，需要通过测试来评估而不是口头判断